<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

  
    
    
      <link href="/css/fonts.css" rel="stylesheet" type="text/css">
    
  

  
  <title>Go and pcaps</title>

  
  
  <link rel="stylesheet" href="/css/hugo-octopress.css">

  
  

  
    <link rel="stylesheet" href="/css/fork-awesome.min.css">
  

  
  <link href="http://localhost:1313/favicon.png" rel="icon">

  
  

  <meta name="description" content="" />
  <meta name="keywords" content="[Parsia Hakimian Parsiya infosec information security]">
  <meta name="author" content="Parsia">

  
  <meta name="generator" content="Hugo 0.83.1" />

  
  

  
  
    

  
    <meta name="twitter:card" content="summary"/>
  
  
  <meta name="twitter:title" content="Go and pcaps"/>
  <meta name="twitter:description" content="I was trying to solve a challenge where the &quot;hidden data&quot; were in ICMP echo payloads. I decided to do it in Go but there were some hiccups on the way. Here are my notes in case (most likely) future me or someone else needs to do the same.

Code is in my clone at:


https://github.com/parsiya/Go-Security/tree/master/pcap-tutorial
"/>
  
  <meta name="twitter:domain" content="parsiya.net"/>
  <meta name="twitter:creator" content="@CryptoGangsta"/>

  

  
  



</head>
<body>


<header role="banner">
<hgroup>
  
  <h1><a href="http://localhost:1313/">அஃக</a></h1>
    <h2>தமிழின் பெரிய சொற்தொகுப்பு</h2>
</hgroup></header>


<nav role="navigation">
<fieldset class="mobile-nav">
  
  <select onchange="location = this.value;">
    <option value="">Navigate…</option>
      
        <option value="http://localhost:1313/about/">» About Me!</option>
      
        <option value="http://localhost:1313/letters/">» எழுத்து</option>
      
  </select>
</fieldset>


<ul class="main-navigation">
  
  
    
      <li><a href="http://localhost:1313/about/" title="About Me!"  target="_blank"  rel="noopener noreferrer">About Me!</a></li>
    
  
    
      <li><a href="http://localhost:1313/letters/" title="எழுத்து"  target="_blank"  rel="noopener noreferrer">எழுத்து</a></li>
    
  
</ul>

<ul class="subscription">
  
    
        <a href="http://localhost:1313/index.xml" target="_blank" type="application/rss+xml" title="RSS" rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a>
    
  
</ul>


  <form action="https://www.google.com/search" method="get" target="_blank" rel="noopener noreferrer">
    <fieldset role="search">
      <input class="search" type="text" name="q" results="0" placeholder="Search"/>
      <input type="hidden" name="q" value="site:http://localhost:1313/" />
    </fieldset>
  </form>

</nav>


<div id="main">
  <div id="content">
    <div>
      <article class="hentry" role="article">

        
        

<header>
  <p class="meta">Dec 3, 2017
     - 7 minute read 
     - <a href="http://localhost:1313/blog/2017-12-03-go-and-pcaps/#disqus_thread">Comments</a>

    
    
      - <a class="label" href="http://localhost:1313/categories/windows/">Windows </a><a class="label" href="http://localhost:1313/categories/go/">Go </a>
    
  </p>
  <h1 class="entry-title">
     Go and pcaps 
  </h1>
</header>


        <div class="entry-content">
          
          
          
            <nav id="TableOfContents">
<ul>
<li><a href="#gopacket">gopacket</a>
<ul>
<li><a href="#go-get-pcap-on-windows">go get pcap on Windows</a></li>
</ul></li>
<li><a href="#reading-pcaps">Reading pcaps</a>
<ul>
<li><a href="#opening-a-pcap-file">Opening a pcap File</a></li>
<li><a href="#setting-filters">Setting Filters</a></li>
<li><a href="#layers">Layers</a>
<ul>
<li><a href="#ipv4-layer">IPv4 Layer</a></li>
</ul></li>
<li><a href="#creating-an-icmp-message-in-go">Creating an ICMP Message in Go</a>
<ul>
<li><a href="#getting-icmp-payload">Getting ICMP Payload</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
          
          <p>I was trying to solve a challenge where the &quot;hidden data&quot; were in ICMP echo payloads. I decided to do it in Go but there were some hiccups on the way. Here are my notes in case (most likely) future me or someone else needs to do the same.</p>

<p>Code is in my clone at:</p>

<ul>
<li><a href="https://github.com/parsiya/Go-Security/tree/master/pcap-tutorial" rel="nofollow" target="_blank">https://github.com/parsiya/Go-Security/tree/master/pcap-tutorial</a></li>
</ul>

<h1 id="gopacket">gopacket</h1>

<p><a href="https://godoc.org/github.com/google/gopacket" rel="nofollow" target="_blank">gopacket</a> is the official Go library for packet manipulation.
It also supports reading and writing pcap files through <code>gopacket/pcap</code>.</p>

<p>I started following <a href="https://www.devdungeon.com/content/packet-capture-injection-and-analysis-gopacket" title="Packet Capture, Injection, and Analysis with Gopacket" rel="nofollow" target="_blank">this tutorial from dev dungeon</a> (skipped
the capturing part because I have a pcap file in hand). We need to <code>go get</code> both
<code>gopacket</code> and <code>gopacket/pcap</code>.</p>

<p><code>go get github.com/google/gopacket/pcap</code> won't work on Windows. I searched
around and found an <a href="https://stackoverflow.com/a/38069376" title="compile gopacket on windows 64bit" rel="nofollow" target="_blank">answer on Stack Overflow</a>.
I got it to work with some modification.</p>

<p>Update February 2020: Seems like this is not an issue anymore. Running the <code>go
get</code> command above worked for me on Windows 10.</p>

<h2 id="go-get-pcap-on-windows">go get pcap on Windows</h2>

<ol>
<li>Install go_amd64 (add go binaries to your PATH). I assume you have a Go environment ready to go.</li>
<li>Install <a href="https://github.com/parsiya/Parsia-Clone/blob/master/random/mingw-windows.md#using-win-buildsorg" rel="nofollow" target="_blank">MinGW x64 via Win-Builds</a> like I have written about before.</li>
<li>Add <code>C:\mingw\x64\bin</code> to PATH.</li>
<li>Install <a href="https://nmap.org/npcap/" rel="nofollow" target="_blank">npcap</a>.</li>
<li>Download <a href="https://www.winpcap.org/devel.htm" rel="nofollow" target="_blank">Winpcap developer's pack</a> and extract it to <code>C:\</code>. <em>So you will have <code>C:\WpdPack</code></em>.</li>
<li>Find <code>wpcap.dll</code> and <code>packet.dll</code> in <code>C:\Windows\System32</code> and copy them somewhere.</li>
<li>Run <code>gendef</code> (from <code>MinGW</code>) on both files.</li>
<li>Generate static library files:

<ul>
<li><code>dlltool --as-flags=--64 -m i386:x86-64 -k --output-lib libwpcap.a --input-def wpcap.def</code></li>
<li><code>dlltool --as-flags=--64 -m i386:x86-64 -k --output-lib libpacket.a --input-def packet.def</code></li>
</ul></li>
<li>Copy <code>libwpcap.a</code> and <code>libpacket.a</code> to <code>c:\WpdPack\Lib\x64</code>.</li>
<li>Finally <code>go get github.com/google/gopacket/pcap</code>.</li>
</ol>

<h1 id="reading-pcaps">Reading pcaps</h1>

<p>Following the tutorial I started making code snippets to do what I wanted. Most
code is based on the tutorial.</p>

<p>Gopacket godoc and source are also your friends:</p>

<ul>
<li><a href="https://godoc.org/github.com/google/gopacket" rel="nofollow" target="_blank">https://godoc.org/github.com/google/gopacket</a></li>
<li><a href="https://github.com/google/gopacket" rel="nofollow" target="_blank">https://github.com/google/gopacket</a></li>
</ul>

<h2 id="opening-a-pcap-file">Opening a pcap File</h2>

<p>This one shows how to open a pcap file and print the packets.</p>





<figure class="code">
  <figcaption>
  	<span>Opening pcap files - pcap-1.go</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#586e75">// Simple go application that opens a pcap file and print the packets
</span><span style="color:#586e75"></span>
<span style="color:#719e07">package</span> main

<span style="color:#719e07">import</span> (
    <span style="color:#2aa198">&#34;fmt&#34;</span>
    <span style="color:#2aa198">&#34;log&#34;</span>

    <span style="color:#2aa198">&#34;github.com/google/gopacket&#34;</span>
    <span style="color:#2aa198">&#34;github.com/google/gopacket/pcap&#34;</span>
)

<span style="color:#268bd2">var</span> (
    pcapFile <span style="color:#dc322f">string</span> = <span style="color:#2aa198">&#34;capt.pcap&#34;</span>
    handle   <span style="color:#719e07">*</span>pcap.Handle
    err      <span style="color:#dc322f">error</span>
)

<span style="color:#268bd2">func</span> <span style="color:#268bd2">main</span>() {
    <span style="color:#586e75">// Open file instead of device
</span><span style="color:#586e75"></span>    handle, err = pcap.<span style="color:#268bd2">OpenOffline</span>(pcapFile)
    <span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
        log.<span style="color:#268bd2">Fatal</span>(err)
    }
    <span style="color:#719e07">defer</span> handle.<span style="color:#268bd2">Close</span>()

    <span style="color:#586e75">// Loop through packets in file
</span><span style="color:#586e75"></span>    packetSource <span style="color:#719e07">:=</span> gopacket.<span style="color:#268bd2">NewPacketSource</span>(handle, handle.<span style="color:#268bd2">LinkType</span>())
    <span style="color:#719e07">for</span> packet <span style="color:#719e07">:=</span> <span style="color:#719e07">range</span> packetSource.<span style="color:#268bd2">Packets</span>() {
        fmt.<span style="color:#268bd2">Println</span>(packet)
    }
}</code></pre></td></tr></table>
</div>
</div>
  </div>
</figure>

<p>But I got the following error:</p>
<pre><code>$ go run go-pcap-test1.go
2017/12/02 15:48:46 bad dump file format
exit status 1</code></pre>
<p>Seems like the original file was in <code>pcapng</code> format which is not supported by
<code>gopacket</code>. Converting the file to <code>pcap</code> worked. The new file is named
<code>conv.pcap</code>.</p>

<h2 id="setting-filters">Setting Filters</h2>

<p>Reading everything in the pcap file is good but not what we want. We want to set
a filter and only read certain packets. This can be done with
<code>handle.SetBPFFilter(filter)</code> in which <code>filter</code> is a string containing a filter
in <a href="http://biot.com/capstats/bpf.html" rel="nofollow" target="_blank">BPF syntax</a>. We just pass the filter <code>icmp</code>:</p>





<figure class="code">
  <figcaption>
  	<span>Setting filters - pcap-2.go</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">41
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#586e75">// How to set a filter and only read certain packets from the pcap file
</span><span style="color:#586e75"></span>
<span style="color:#719e07">package</span> main

<span style="color:#719e07">import</span> (
    <span style="color:#2aa198">&#34;fmt&#34;</span>
    <span style="color:#2aa198">&#34;log&#34;</span>

    <span style="color:#2aa198">&#34;github.com/google/gopacket&#34;</span>
    <span style="color:#2aa198">&#34;github.com/google/gopacket/pcap&#34;</span>
)

<span style="color:#268bd2">var</span> (
    pcapFile <span style="color:#dc322f">string</span> = <span style="color:#2aa198">&#34;conv.pcap&#34;</span>
    handle   <span style="color:#719e07">*</span>pcap.Handle
    err      <span style="color:#dc322f">error</span>
)

<span style="color:#268bd2">func</span> <span style="color:#268bd2">main</span>() {
    <span style="color:#586e75">// Open file instead of device
</span><span style="color:#586e75"></span>    handle, err = pcap.<span style="color:#268bd2">OpenOffline</span>(pcapFile)
    <span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
        log.<span style="color:#268bd2">Fatal</span>(err)
    }
    <span style="color:#719e07">defer</span> handle.<span style="color:#268bd2">Close</span>()

    <span style="color:#586e75">// Set filter
</span><span style="color:#586e75"></span>    <span style="color:#268bd2">var</span> filter <span style="color:#dc322f">string</span> = <span style="color:#2aa198">&#34;icmp&#34;</span>
    err = handle.<span style="color:#268bd2">SetBPFFilter</span>(filter)
    <span style="color:#719e07">if</span> err <span style="color:#719e07">!=</span> <span style="color:#cb4b16">nil</span> {
        log.<span style="color:#268bd2">Fatal</span>(err)
    }
    fmt.<span style="color:#268bd2">Println</span>(<span style="color:#2aa198">&#34;Filter set to ICMP.&#34;</span>)

    packetSource <span style="color:#719e07">:=</span> gopacket.<span style="color:#268bd2">NewPacketSource</span>(handle, handle.<span style="color:#268bd2">LinkType</span>())

    <span style="color:#719e07">for</span> packet <span style="color:#719e07">:=</span> <span style="color:#719e07">range</span> packetSource.<span style="color:#268bd2">Packets</span>() {
        <span style="color:#586e75">// Do something with a packet here.
</span><span style="color:#586e75"></span>        fmt.<span style="color:#268bd2">Println</span>(packet)
    }
}</code></pre></td></tr></table>
</div>
</div>
  </div>
</figure>

<p>This code only reads packets of type <code>icmp</code>.</p>

<h2 id="layers">Layers</h2>

<p><code>gopacket</code> is based on layers. You can get each layer from raw packet data
(either from the pcap file or just bytes). Layers are in
<code>github.com/google/gopacket/layers</code>. We are interested in IPv4 pings so I used
<code>ipLayer := packet.Layer(layers.LayerTypeIPv4)</code>.</p>

<p>Now <code>ipLayer</code> is a <code>*layers.IPv4</code> (don't worry about it being a pointer) and we
can print it with <code>fmt.Printf(&quot;%+v&quot;, ipLayer)</code> to get:</p>





<figure class="code">
  <figcaption>
  	<span>ipLayer contents</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">&amp;</span>{BaseLayer:{Contents:[<span style="color:#2aa198">69</span> <span style="color:#2aa198">0</span> <span style="color:#2aa198">0</span> <span style="color:#2aa198">114</span> <span style="color:#2aa198">185</span> <span style="color:#2aa198">229</span> <span style="color:#2aa198">64</span> <span style="color:#2aa198">0</span> <span style="color:#2aa198">64</span> <span style="color:#2aa198">1</span> <span style="color:#2aa198">29</span> <span style="color:#2aa198">246</span> <span style="color:#2aa198">172</span> <span style="color:#2aa198">16</span> <span style="color:#2aa198">133</span> <span style="color:#2aa198">141</span> <span style="color:#2aa198">172</span>
                       <span style="color:#2aa198">16</span> <span style="color:#2aa198">133</span> <span style="color:#2aa198">1</span>]
Payload:[<span style="color:#2aa198">8</span> <span style="color:#2aa198">0</span> <span style="color:#2aa198">157</span> <span style="color:#2aa198">204</span> <span style="color:#2aa198">16</span> <span style="color:#2aa198">68</span> <span style="color:#2aa198">10</span> <span style="color:#2aa198">36</span> <span style="color:#2aa198">36</span> <span style="color:#2aa198">83</span> <span style="color:#2aa198">84</span> <span style="color:#2aa198">65</span> <span style="color:#2aa198">82</span> <span style="color:#2aa198">84</span> <span style="color:#2aa198">36</span> <span style="color:#2aa198">36</span> <span style="color:#2aa198">83</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">70</span> <span style="color:#2aa198">116</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">72</span> <span style="color:#2aa198">78</span>
         <span style="color:#2aa198">111</span> <span style="color:#2aa198">89</span> <span style="color:#2aa198">87</span> <span style="color:#2aa198">53</span> <span style="color:#2aa198">114</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">72</span> <span style="color:#2aa198">74</span> <span style="color:#2aa198">49</span> <span style="color:#2aa198">98</span> <span style="color:#2aa198">88</span> <span style="color:#2aa198">65</span> <span style="color:#2aa198">115</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">53</span> <span style="color:#2aa198">49</span> <span style="color:#2aa198">98</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">120</span> <span style="color:#2aa198">104</span> <span style="color:#2aa198">73</span>
         <span style="color:#2aa198">71</span> <span style="color:#2aa198">53</span> <span style="color:#2aa198">118</span> <span style="color:#2aa198">98</span> <span style="color:#2aa198">105</span> <span style="color:#2aa198">66</span> <span style="color:#2aa198">104</span> <span style="color:#2aa198">98</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">78</span> <span style="color:#2aa198">104</span> <span style="color:#2aa198">100</span> <span style="color:#2aa198">72</span> <span style="color:#2aa198">74</span> <span style="color:#2aa198">104</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">72</span> <span style="color:#2aa198">86</span> <span style="color:#2aa198">48</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">82</span>
         <span style="color:#2aa198">108</span> <span style="color:#2aa198">99</span> <span style="color:#2aa198">50</span> <span style="color:#2aa198">86</span> <span style="color:#2aa198">121</span> <span style="color:#2aa198">100</span> <span style="color:#2aa198">87</span> <span style="color:#2aa198">53</span> <span style="color:#2aa198">48</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">49</span> <span style="color:#2aa198">112</span> <span style="color:#2aa198">98</span> <span style="color:#2aa198">109</span> <span style="color:#2aa198">108</span> <span style="color:#2aa198">116</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">74</span> <span style="color:#2aa198">118</span>
         <span style="color:#2aa198">100</span> <span style="color:#2aa198">87</span> <span style="color:#2aa198">82</span> <span style="color:#2aa198">112</span> <span style="color:#2aa198">10</span>]}
Version:<span style="color:#2aa198">4</span> IHL:<span style="color:#2aa198">5</span> TOS:<span style="color:#2aa198">0</span> Length:<span style="color:#2aa198">114</span> Id:<span style="color:#2aa198">47589</span> Flags:DF FragOffset:<span style="color:#2aa198">0</span> TTL:<span style="color:#2aa198">64</span>
Protocol:ICMPv4 Checksum:<span style="color:#2aa198">7670</span> SrcIP:<span style="color:#2aa198">172.16.133.141</span> DstIP:<span style="color:#2aa198">172.16.133.1</span>
Options:[] Padding:[]}</code></pre></td></tr></table>
</div>
</div>
  </div>
</figure>

<p>Remember those are printed in decimal (bytes are just uint8 in go) and not hex.
Personally I prefer printing in hex because it's easier for me to read
ASCII-Hex.</p>

<h3 id="ipv4-layer">IPv4 Layer</h3>

<p>At this point you would think we could just do <code>ipLayer.Payload</code> and read it but
we get:</p>

<p><code>ipLayer.Payload undefined (type gopacket.Layer has no field or method Payload)</code></p>

<p>But if we print the type with <code>%T</code> we get <code>*layers.IPv4</code> and when we print it
with <code>%+v</code> we can see the <code>Payload</code> field.</p>

<p>What we have is an interface and the compiler does not know it's going to be
populated by <code>*layers.IPv4</code> at runtime. We need to cast the packet to
<code>*layers.IPv4</code> manually. Then we can access <code>Payload</code>:</p>





<figure class="code">
  <figcaption>
  	<span>Casting ipLayer to ip</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">ip, _ <span style="color:#719e07">:=</span> ipLayer.(<span style="color:#719e07">*</span>layers.IPv4)

fmt.<span style="color:#268bd2">Println</span>(ip.Payload)
fmt.<span style="color:#268bd2">Println</span>(<span style="color:#b58900">len</span>(ip.Payload))
fmt.<span style="color:#268bd2">Println</span>(<span style="color:#b58900">string</span>(ip.Payload))</code></pre></td></tr></table>
</div>
</div>
  </div>
</figure>

<p>Which results in</p>





<figure class="code">
  <figcaption>
  	<span>Contents of ip</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">[<span style="color:#2aa198">8</span> <span style="color:#2aa198">0</span> <span style="color:#2aa198">157</span> <span style="color:#2aa198">204</span> <span style="color:#2aa198">16</span> <span style="color:#2aa198">68</span> <span style="color:#2aa198">1</span> <span style="color:#2aa198">0</span> <span style="color:#2aa198">36</span> <span style="color:#2aa198">36</span> <span style="color:#2aa198">83</span> <span style="color:#2aa198">84</span> <span style="color:#2aa198">65</span> <span style="color:#2aa198">82</span> <span style="color:#2aa198">84</span> <span style="color:#2aa198">36</span> <span style="color:#2aa198">36</span> <span style="color:#2aa198">83</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">70</span> <span style="color:#2aa198">116</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">72</span> <span style="color:#2aa198">78</span> <span style="color:#2aa198">111</span> <span style="color:#2aa198">89</span>
<span style="color:#2aa198">87</span> <span style="color:#2aa198">53</span> <span style="color:#2aa198">114</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">72</span> <span style="color:#2aa198">74</span> <span style="color:#2aa198">49</span> <span style="color:#2aa198">98</span> <span style="color:#2aa198">88</span> <span style="color:#2aa198">65</span> <span style="color:#2aa198">115</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">53</span> <span style="color:#2aa198">49</span> <span style="color:#2aa198">98</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">120</span> <span style="color:#2aa198">104</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">53</span> <span style="color:#2aa198">118</span> <span style="color:#2aa198">98</span> <span style="color:#2aa198">105</span>
<span style="color:#2aa198">66</span> <span style="color:#2aa198">104</span> <span style="color:#2aa198">98</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">78</span> <span style="color:#2aa198">104</span> <span style="color:#2aa198">100</span> <span style="color:#2aa198">72</span> <span style="color:#2aa198">74</span> <span style="color:#2aa198">104</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">72</span> <span style="color:#2aa198">86</span> <span style="color:#2aa198">48</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">82</span> <span style="color:#2aa198">108</span> <span style="color:#2aa198">99</span> <span style="color:#2aa198">50</span> <span style="color:#2aa198">86</span> <span style="color:#2aa198">121</span> <span style="color:#2aa198">100</span> <span style="color:#2aa198">87</span>
<span style="color:#2aa198">53</span> <span style="color:#2aa198">48</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">49</span> <span style="color:#2aa198">112</span> <span style="color:#2aa198">98</span> <span style="color:#2aa198">109</span> <span style="color:#2aa198">108</span> <span style="color:#2aa198">116</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">74</span> <span style="color:#2aa198">118</span> <span style="color:#2aa198">100</span> <span style="color:#2aa198">87</span> <span style="color:#2aa198">82</span> <span style="color:#2aa198">112</span> <span style="color:#2aa198">10</span>]

<span style="color:#2aa198">94</span>

[garbage] $$START$$SGFtIHNoYW5rIHJ1bXAsIG51bGxhIG5vbiBhbGNhdHJhIHV0IGRlc2VydW50
          IG1pbmltIGJvdWRp</code></pre></td></tr></table>
</div>
</div>
  </div>
</figure>

<p>For more info see section <a href="https://godoc.org/github.com/google/gopacket#hdr-Pointers_To_Known_Layers" title="gopacket - Pointers To Known Layers" rel="nofollow" target="_blank">Pointers to Known Layers</a> in
gopacket docs.</p>

<p>So we mostly got everything, the payload is some headers and then base64 encoded
data. We could just discard the first 8 (header) + 9 (<code>$$START$$</code>) and grab what
we want. But let's do things properly.</p>

<h2 id="creating-an-icmp-message-in-go">Creating an ICMP Message in Go</h2>

<p>We can create an <code>icmp</code> message from the IPv4 layer payload.</p>

<p>First we need <code>go get golang.org/x/net/icmp</code> and then:</p>





<figure class="code">
  <figcaption>
  	<span>Creating an icmp message from IP payload</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#268bd2">const</span> (
    ProtocolICMP     = <span style="color:#2aa198">1</span>  <span style="color:#586e75">// Internet Control Message
</span><span style="color:#586e75"></span>    ProtocolIPv6ICMP = <span style="color:#2aa198">58</span> <span style="color:#586e75">// ICMP for IPv6
</span><span style="color:#586e75"></span>)

<span style="color:#719e07">...</span>

msg, err <span style="color:#719e07">:=</span> icmp.<span style="color:#268bd2">ParseMessage</span>(ProtocolICMP, ip.Payload)</code></pre></td></tr></table>
</div>
</div>
  </div>
</figure>

<p><code>ProtocolICMP</code> and <code>ProtocolIPv6ICMP</code> are defined in
<code>golang.org/x/net/internal/iana</code>. It's an internal package and we cannot use it
directly. Instead I have copied the constants directly in my code.</p>

<p>The result is <a href="https://godoc.org/golang.org/x/net/icmp#Message" rel="nofollow" target="_blank">*icmp.Message</a>:</p>





<figure class="code">
  <figcaption>
  	<span>icmp.Message struct</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#268bd2">type</span> Message <span style="color:#268bd2">struct</span> {
    Type     Type        <span style="color:#586e75">// type, either ipv4.ICMPType or ipv6.ICMPType
</span><span style="color:#586e75"></span>    Code     <span style="color:#dc322f">int</span>         <span style="color:#586e75">// code
</span><span style="color:#586e75"></span>    Checksum <span style="color:#dc322f">int</span>         <span style="color:#586e75">// checksum
</span><span style="color:#586e75"></span>    Body     MessageBody <span style="color:#586e75">// body
</span><span style="color:#586e75"></span>}</code></pre></td></tr></table>
</div>
</div>
  </div>
</figure>

<p>We are interested in <code>Body</code> of type <a href="https://godoc.org/golang.org/x/net/icmp#MessageBody" rel="nofollow" target="_blank">MessageBody</a> which
is again an interface. If we print the value and type we get:</p>





<figure class="code">
  <figcaption>
  	<span>ip.Body</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">&amp;</span>{ID:<span style="color:#2aa198">4164</span> Seq:<span style="color:#2aa198">256</span>
  Data:[<span style="color:#2aa198">36</span> <span style="color:#2aa198">36</span> <span style="color:#2aa198">83</span> <span style="color:#2aa198">84</span> <span style="color:#2aa198">65</span> <span style="color:#2aa198">82</span> <span style="color:#2aa198">84</span> <span style="color:#2aa198">36</span> <span style="color:#2aa198">36</span> <span style="color:#2aa198">83</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">70</span> <span style="color:#2aa198">116</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">72</span> <span style="color:#2aa198">78</span> <span style="color:#2aa198">111</span> <span style="color:#2aa198">89</span> <span style="color:#2aa198">87</span> <span style="color:#2aa198">53</span> <span style="color:#2aa198">114</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">72</span>
        <span style="color:#2aa198">74</span> <span style="color:#2aa198">49</span> <span style="color:#2aa198">98</span> <span style="color:#2aa198">88</span> <span style="color:#2aa198">65</span> <span style="color:#2aa198">115</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">53</span> <span style="color:#2aa198">49</span> <span style="color:#2aa198">98</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">120</span> <span style="color:#2aa198">104</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">53</span> <span style="color:#2aa198">118</span> <span style="color:#2aa198">98</span> <span style="color:#2aa198">105</span> <span style="color:#2aa198">66</span> <span style="color:#2aa198">104</span>
        <span style="color:#2aa198">98</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">78</span> <span style="color:#2aa198">104</span> <span style="color:#2aa198">100</span> <span style="color:#2aa198">72</span> <span style="color:#2aa198">74</span> <span style="color:#2aa198">104</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">72</span> <span style="color:#2aa198">86</span> <span style="color:#2aa198">48</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">82</span> <span style="color:#2aa198">108</span> <span style="color:#2aa198">99</span> <span style="color:#2aa198">50</span> <span style="color:#2aa198">86</span> <span style="color:#2aa198">121</span> <span style="color:#2aa198">100</span> <span style="color:#2aa198">87</span>
        <span style="color:#2aa198">53</span> <span style="color:#2aa198">48</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">49</span> <span style="color:#2aa198">112</span> <span style="color:#2aa198">98</span> <span style="color:#2aa198">109</span> <span style="color:#2aa198">108</span> <span style="color:#2aa198">116</span> <span style="color:#2aa198">73</span> <span style="color:#2aa198">71</span> <span style="color:#2aa198">74</span> <span style="color:#2aa198">118</span> <span style="color:#2aa198">100</span> <span style="color:#2aa198">87</span> <span style="color:#2aa198">82</span> <span style="color:#2aa198">112</span> <span style="color:#2aa198">10</span>]}

<span style="color:#719e07">*</span>icmp.Echo</code></pre></td></tr></table>
</div>
</div>
  </div>
</figure>

<h3 id="getting-icmp-payload">Getting ICMP Payload</h3>

<p>But again we need to cast it to <code>*icmp.Echo</code> before we can get the <code>Data</code> field
which contains the payload.</p>





<figure class="code">
  <figcaption>
  	<span>Casting ip.Body to *icmp.Echo</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">if</span> body, err <span style="color:#719e07">:=</span> msg.Body.(<span style="color:#719e07">*</span>icmp.Echo); err {
    <span style="color:#586e75">// Now we can access Body.Data
</span><span style="color:#586e75"></span>    fmt.<span style="color:#268bd2">Println</span>(<span style="color:#b58900">string</span>(body.Data))
}</code></pre></td></tr></table>
</div>
</div>
  </div>
</figure>

<p>Now we have the payload:</p>

<p><code>$$START$$SGFtIHNoYW5rIHJ1bXAsIG51bGxhIG5vbiBhbGNhdHJhIHV0IGRlc2VydW50IG1pbmltIGJvdWRp</code></p>

<p>This is base64 encoded and we can decode it after removing <code>$$START$$</code>:</p>

<ul>
<li><code>Ham shank rump, nulla non alcatra ut deserunt minim boudi</code></li>
</ul>

<p>The rest is easy. Complete code for this section is in <code>pcap-3.go</code>.</p>

<!-- Links -->
        </div>
        

<footer>
  <p class="meta">
    <span class="byline author vcard">Posted by <span class="fn">Parsia</span></span>
    
    <time>Dec 3, 2017</time>
    
      <span class="categories">
        Tags:
        
          <a class="category" href="http://localhost:1313/tags/pcap">pcap</a>  
    
    </span>
  </p>

  

  <p class="meta">
    
        <a class="basic-alignment left" href="http://localhost:1313/blog/2017-11-29-hacking-car-mechanic-simulator-2015/" title="&#34;Hacking&#34; Car Mechanic Simulator 2015">&#34;Hacking&#34; Car Mechanic Simulator 2015</a>
    

    
      <a class="basic-alignment right" href="http://localhost:1313/blog/2017-12-19-windows-xp-32-bit-sp3-virtual-machines/" title="Windows XP 32-bit SP3 Virtual Machines">Windows XP 32-bit SP3 Virtual Machines</a>
    
  </p>
  
    
      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "parsiya" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
  
</footer>

      </article>
    </div>
    

<aside class="sidebar thirds">
  <section class="first odd">

    
      <h1>Who am I?</h1>
    

    <p>
      
        <p>I am Pitchaimuthu Muthaiya, a senior security engineer.</p>

<p>I write about application tamil words and roots of words.</p>

<p>Click on <a href="/about/">About Me!</a> to know more.</p>

      
    </p>
  </section>



  
  <ul class="sidebar-nav">
    <li class="sidebar-nav-item">
      <a target="_blank" rel="noopener noreferrer" href="https://github.com/parsiya/" title="https://github.com/parsiya/"><i class="fa fa-github fa-3x"></i></a>
      
      
      <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/cryptogangsta/" title="https://twitter.com/cryptogangsta/"><i class="fa fa-twitter fa-3x"></i></a>
      
        <a target="_blank" rel="noopener noreferrer" href="https://keybase.io/parsiya/" title="https://keybase.io/parsiya/"><i class="fa fa-keybase fa-3x"></i></a> 
      
      <a target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/parsiya" title="https://www.linkedin.com/in/parsiya"><i class="fa fa-linkedin fa-3x"></i></a>
      
      
      
      
      

    
    
    </li>
  </ul>

  

  
    
      <section class="odd">
        
          <h1>Collections</h1>
        
        
          <li>
            <a href="http://localhost:1313/categories/thick-client-proxying/" title="Thick Client Proxying" >Thick Client Proxying</a>
          </li>
        
          <li>
            <a href="http://localhost:1313/categories/writeup/" title="CTFs/Writeups" >CTFs/Writeups</a>
          </li>
        
          <li>
            <a href="http://localhost:1313/categories/attack-surface-analysis/" title="Attack Surface Analysis" >Attack Surface Analysis</a>
          </li>
        
          <li>
            <a href="http://localhost:1313/categories/bug-bounty/" title="Bug Bounty" >Bug Bounty</a>
          </li>
        
          <li>
            <a href="http://localhost:1313/categories/go/" title="Go/Golang" >Go/Golang</a>
          </li>
        
          <li>
            <a href="http://localhost:1313/categories/blockchain/" title="Blockchain" >Blockchain</a>
          </li>
        
          <li>
            <a href="http://localhost:1313/categories/burp-extension/" title="Burp Extension Development" >Burp Extension Development</a>
          </li>
        
          <li>
            <a href="http://localhost:1313/categories/automation/" title="Automation" >Automation</a>
          </li>
        
          <li>
            <a href="http://localhost:1313/categories/reverse-engineering/" title="Reverse Engineering" >Reverse Engineering</a>
          </li>
        
          <li>
            <a href="http://localhost:1313/categories/crypto/" title="Crypto(graphy)" >Crypto(graphy)</a>
          </li>
        
          <li>
            <a href="http://localhost:1313/categories/winappdbg/" title="WinAppDbg" >WinAppDbg</a>
          </li>
        
          <li>
            <a href="https://awsome.pw" title="AWSome.pw - S3 bucket squatting - my very legit branded vulnerability" >AWSome.pw - S3 bucket squatting - my very legit branded vulnerability</a>
          </li>
        
      </section>
    
  

  
  
  
</aside>

  </div>
</div>

    <footer role="contentinfo">
      <p>Copyright &copy; 2021 Parsia - <a href="http://localhost:1313/license/">License</a> -
        <span class="credit">Powered by <a target="_blank" href="https://gohugo.io" rel="noopener noreferrer">Hugo</a> and <a target="_blank" href="https://github.com/parsiya/hugo-octopress/" rel="noopener noreferrer">Hugo-Octopress</a> theme.
      </p>
    </footer>

    
    



    
    
    

    
  </body>
</html>

